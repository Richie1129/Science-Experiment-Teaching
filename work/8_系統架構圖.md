# 系統架構圖

## 整體系統架構

### 三層式架構設計
```
┌─────────────────────────────────────────────────────────┐
│                    前端層 (Frontend)                    │
├─────────────────────────────────────────────────────────┤
│                    應用層 (Backend)                     │
├─────────────────────────────────────────────────────────┤
│                  資料儲存層 (Storage)                   │
└─────────────────────────────────────────────────────────┘
```

## 詳細系統架構

### 前端層 (Presentation Layer)
```
┌─────────────────────────────────────────────────────────┐
│                      Web Browser                        │
├─────────────────────────────────────────────────────────┤
│                                                        │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │   學生介面    │  │   教師介面    │  │  管理介面     │ │
│  │  (Student)   │  │  (Teacher)   │  │  (Admin)     │ │
│  │              │  │              │  │              │ │
│  │ • 實驗選擇   │  │ • 實驗管理   │  │ • 系統設定   │ │
│  │ • 步驟追蹤   │  │ • 數據分析   │  │ • 用戶管理   │ │
│  │ • AI 問答    │  │ • 內容編輯   │  │ • 監控面板   │ │
│  └──────────────┘  └──────────────┘  └──────────────┘ │
│                                                        │
├─────────────────────────────────────────────────────────┤
│                    靜態資源層                           │
│                                                        │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌─────────┐ │
│  │   HTML   │  │   CSS    │  │    JS    │  │  Images │ │
│  │          │  │          │  │          │  │         │ │
│  │ • index  │  │ • style  │  │ • main   │  │ • icons │ │
│  │ • teacher│  │ • bootstrap│ │ • jquery │  │ • logos │ │
│  └──────────┘  └──────────┘  └──────────┘  └─────────┘ │
└─────────────────────────────────────────────────────────┘
```

### 應用層 (Application Layer)
```
┌─────────────────────────────────────────────────────────┐
│                   Node.js Express Server                │
├─────────────────────────────────────────────────────────┤
│                                                        │
│  ┌──────────────────────────────────────────────────┐  │
│  │                 API 路由層                        │  │
│  │                                                  │  │
│  │ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────┐ │  │
│  │ │學生 API   │ │教師 API   │ │實驗 API   │ │AI API │ │  │
│  │ │          │ │          │ │          │ │      │ │  │
│  │ │• 獲取實驗 │ │• 登入驗證 │ │• CRUD    │ │• 問答 │ │  │
│  │ │• 進度更新 │ │• 內容管理 │ │• 檔案上傳│ │• 轉錄 │ │  │
│  │ │• 提交問題 │ │• 數據查詢 │ │• 狀態管理│ │• 分析 │ │  │
│  │ └──────────┘ └──────────┘ └──────────┘ └──────┘ │  │
│  └──────────────────────────────────────────────────┘  │
│                                                        │
│  ┌──────────────────────────────────────────────────┐  │
│  │                  業務邏輯層                       │  │
│  │                                                  │  │
│  │ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────┐ │  │
│  │ │實驗管理   │ │用戶管理   │ │檔案處理   │ │AI整合 │ │  │
│  │ │          │ │          │ │          │ │      │ │  │
│  │ │• 實驗CRUD │ │• 身份驗證 │ │• 上傳處理│ │• GPT │ │  │
│  │ │• 進度追蹤 │ │• 權限控制 │ │• 格式轉換│ │• 語音 │ │  │
│  │ │• 數據統計 │ │• 行為記錄 │ │• 儲存管理│ │• 分析 │ │  │
│  │ └──────────┘ └──────────┘ └──────────┘ └──────┘ │  │
│  └──────────────────────────────────────────────────┘  │
│                                                        │
│  ┌──────────────────────────────────────────────────┐  │
│  │                  中介軟體層                       │  │
│  │                                                  │  │
│  │ • Express.json() - JSON 解析                      │  │
│  │ • Express.static() - 靜態檔案服務                 │  │
│  │ • Multer - 檔案上傳處理                          │  │
│  │ • CORS - 跨域請求處理                            │  │
│  │ • 錯誤處理中介軟體                               │  │
│  │ • 日誌記錄中介軟體                               │  │
│  └──────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

### 外部服務整合層
```
┌─────────────────────────────────────────────────────────┐
│                    第三方服務整合                        │
├─────────────────────────────────────────────────────────┤
│                                                        │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │  OpenAI API  │  │  FFmpeg 服務  │  │  檔案系統     │ │
│  │              │  │              │  │              │ │
│  │ • GPT-4 問答  │  │ • 影片轉音訊  │  │ • 本地儲存   │ │
│  │ • 文字生成   │  │ • 音訊處理   │  │ • 上傳管理   │ │
│  │ • 語音轉文字 │  │ • 格式轉換   │  │ • 備份機制   │ │
│  └──────────────┘  └──────────────┘  └──────────────┘ │
└─────────────────────────────────────────────────────────┘
```

### 資料儲存層 (Data Layer)
```
┌─────────────────────────────────────────────────────────┐
│                      檔案系統儲存                        │
├─────────────────────────────────────────────────────────┤
│                                                        │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │   JSON 檔案   │  │  媒體檔案     │  │   日誌檔案    │ │
│  │              │  │              │  │              │ │
│  │ • experiments│  │ • uploads/   │  │ • system.log │ │
│  │   .json      │  │   videos/    │  │ • error.log  │ │
│  │              │  │   audios/    │  │ • access.log │ │
│  │ • users.json │  │   images/    │  │              │ │
│  │ • config.json│  │              │  │              │ │
│  └──────────────┘  └──────────────┘  └──────────────┘ │
│                                                        │
│  資料結構:                                             │
│  experiments.json:                                     │
│  [{                                                    │
│    "id": "1749124544989",                              │
│    "name": "濕與乾的秘密",                              │
│    "materials": ["水盆", "玻璃杯", ...],                │
│    "steps": [{"description": "...", "completed": false}],│
│    "videoFile": "demo.mp4",                            │
│    "transcript": "轉錄文字...",                        │
│    "createdAt": "2024-06-05T11:55:44.989Z"             │
│  }]                                                    │
└─────────────────────────────────────────────────────────┘
```

## 技術堆疊詳細

### 前端技術
```
┌─────────────────────────────────────────────┐
│               前端技術堆疊                   │
├─────────────────────────────────────────────┤
│                                            │
│ 🌐 HTML5                                   │
│   • 語義化標籤                             │
│   • 響應式 Meta 標籤                       │
│   • 無障礙支援                             │
│                                            │
│ 🎨 CSS3 / Bootstrap 5                      │
│   • 響應式設計                             │
│   • Flexbox/Grid 佈局                      │
│   • 自定義主題                             │
│                                            │
│ ⚡ JavaScript (ES6+)                       │
│   • 模組化開發                             │
│   • async/await                           │
│   • DOM 操作                              │
│                                            │
│ 📚 第三方函式庫                             │
│   • Bootstrap 5.3.0                       │
│   • Remix Icon 3.5.0                      │
│   • 自定義 CSS/JS                          │
└─────────────────────────────────────────────┘
```

### 後端技術
```
┌─────────────────────────────────────────────┐
│               後端技術堆疊                   │
├─────────────────────────────────────────────┤
│                                            │
│ 🟢 Node.js (Runtime)                       │
│   • 版本: 18.x LTS                         │
│   • 事件驅動架構                           │
│   • 非阻塞 I/O                             │
│                                            │
│ 🚀 Express.js (Web Framework)              │
│   • 版本: 4.x                              │
│   • RESTful API                           │
│   • 中介軟體支援                           │
│                                            │
│ 📦 核心套件                                │
│   • multer - 檔案上傳                      │
│   • fluent-ffmpeg - 影片處理               │
│   • pdfkit - PDF 生成                      │
│   • dotenv - 環境變數                      │
│                                            │
│ 🤖 AI 整合                                 │
│   • OpenAI SDK                            │
│   • GPT-4 API                             │
│   • Whisper API (語音轉文字)                │
└─────────────────────────────────────────────┘
```

## 系統部署架構

### 容器化部署
```
┌─────────────────────────────────────────────────────────┐
│                     Docker 容器                         │
├─────────────────────────────────────────────────────────┤
│                                                        │
│  ┌──────────────────────────────────────────────────┐  │
│  │                 Web Application                   │  │
│  │                                                  │  │
│  │ • Node.js Express Server                         │  │
│  │ • 靜態檔案服務                                   │  │
│  │ • API 服務                                       │  │
│  │ • 埠號: 3000                                     │  │
│  └──────────────────────────────────────────────────┘  │
│                                                        │
│  ┌──────────────────────────────────────────────────┐  │
│  │                  檔案系統                         │  │
│  │                                                  │  │
│  │ • /app/data/ - JSON 資料檔                       │  │
│  │ • /app/uploads/ - 上傳檔案                       │  │
│  │ • /app/logs/ - 系統日誌                          │  │
│  └──────────────────────────────────────────────────┘  │
│                                                        │
│  環境變數:                                             │
│  • PORT=3000                                          │
│  • OPENAI_API_KEY=sk-...                              │
│  • NODE_ENV=production                                 │
└─────────────────────────────────────────────────────────┘
```

### 網路架構
```
┌─────────────────────────────────────────────────────────┐
│                     網路層架構                           │
├─────────────────────────────────────────────────────────┤
│                                                        │
│  Internet                                              │
│      ↓                                                 │
│  ┌──────────────┐                                      │
│  │   Load Balancer │ (可選)                            │
│  │   (Nginx/HAProxy) │                                 │
│  └──────────────┘                                      │
│      ↓                                                 │
│  ┌──────────────┐                                      │
│  │  Web Server   │                                     │
│  │  Node.js App  │                                     │
│  │  Port: 3000   │                                     │
│  └──────────────┘                                      │
│      ↓                                                 │
│  ┌──────────────┐  ┌──────────────┐                    │
│  │ File System  │  │ External APIs │                   │
│  │ Local Storage│  │ • OpenAI      │                   │
│  └──────────────┘  │ • FFmpeg      │                   │
│                    └──────────────┘                    │
└─────────────────────────────────────────────────────────┘
```

## 安全架構

### 安全層級設計
```
┌─────────────────────────────────────────────────────────┐
│                      安全架構                           │
├─────────────────────────────────────────────────────────┤
│                                                        │
│  ┌──────────────────────────────────────────────────┐  │
│  │                  應用層安全                       │  │
│  │                                                  │  │
│  │ • 教師密碼驗證                                   │  │
│  │ • 檔案上傳限制                                   │  │
│  │ • 輸入驗證與清理                                 │  │
│  │ • API 速率限制                                   │  │
│  └──────────────────────────────────────────────────┘  │
│                                                        │
│  ┌──────────────────────────────────────────────────┐  │
│  │                  資料安全                         │  │
│  │                                                  │  │
│  │ • 環境變數保護 API Key                           │  │
│  │ • 檔案系統權限控制                               │  │
│  │ • 敏感資料加密                                   │  │
│  │ • 定期備份機制                                   │  │
│  └──────────────────────────────────────────────────┘  │
│                                                        │
│  ┌──────────────────────────────────────────────────┐  │
│  │                  網路安全                         │  │
│  │                                                  │  │
│  │ • HTTPS 強制使用                                 │  │
│  │ • CORS 設定                                      │  │
│  │ • 防止 XSS 攻擊                                  │  │
│  │ • SQL 注入防護                                   │  │
│  └──────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

## 擴展性考量

### 水平擴展架構
```
┌─────────────────────────────────────────────────────────┐
│                    可擴展架構設計                        │
├─────────────────────────────────────────────────────────┤
│                                                        │
│  階段一: 單體應用 (目前)                               │
│  ┌──────────────┐                                      │
│  │ Single Node.js│                                     │
│  │ Application   │                                     │
│  └──────────────┘                                      │
│                                                        │
│  階段二: 微服務架構 (未來)                             │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐               │
│  │ Web API  │ │ AI Service│ │ File Svc │               │
│  │ Service  │ │          │ │         │               │
│  └──────────┘ └──────────┘ └──────────┘               │
│       ↓             ↓           ↓                     │
│  ┌─────────────────────────────────────┐               │
│  │         Message Queue/Bus           │               │
│  └─────────────────────────────────────┘               │
│                                                        │
│  階段三: 雲端架構 (擴展)                               │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐               │
│  │Container │ │Container │ │Container │               │
│  │Instance 1│ │Instance 2│ │Instance N│               │
│  └──────────┘ └──────────┘ └──────────┘               │
│       ↓             ↓           ↓                     │
│  ┌─────────────────────────────────────┐               │
│  │        Load Balancer/CDN            │               │
│  └─────────────────────────────────────┘               │
└─────────────────────────────────────────────────────────┘
```

## 監控與維護架構

### 系統監控
```
┌─────────────────────────────────────────────────────────┐
│                     監控系統                            │
├─────────────────────────────────────────────────────────┤
│                                                        │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │  效能監控     │  │  錯誤追蹤     │  │  使用分析     │ │
│  │              │  │              │  │              │ │
│  │ • CPU 使用率  │  │ • Error Logs │  │ • 使用者統計 │ │
│  │ • 記憶體監控 │  │ • Stack Trace│  │ • 功能使用率 │ │
│  │ • 磁碟空間   │  │ • API 錯誤   │  │ • 學習進度   │ │
│  │ • 網路流量   │  │ • 系統異常   │  │ • 滿意度調查 │ │
│  └──────────────┘  └──────────────┘  └──────────────┘ │
│                                                        │
│  監控工具:                                             │
│  • Winston (日誌記錄)                                  │
│  • PM2 (程序管理)                                      │
│  • 自定義監控儀表板                                    │
└─────────────────────────────────────────────────────────┘